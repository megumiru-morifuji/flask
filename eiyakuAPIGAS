function doPost(e) {

  try {
    const json = JSON.parse(e.postData.contents);
    const originalText = json.originalText;
    const translatedText = json.translatedText;

    // console.log çš„ãªãƒ­ã‚°å‡ºåŠ›ï¼ˆGASã®ãƒ­ã‚°ã§ç¢ºèªã§ãã‚‹ï¼‰
    Logger.log("ğŸŒ Original Text: " + originalText);
    Logger.log("ğŸ“ Translated Text: " + translatedText);

    return ContentService.createTextOutput("Logged successfully.");
  } catch (error) {
    Logger.log("âŒ Error: " + error);
    return ContentService.createTextOutput("Error occurred.");
  }
}

function onTranslateClick() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const cell = sheet.getActiveCell();
  const text = cell.getValue();
  Logger.log("ç¿»è¨³å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆ: " + text);

  const options = {
    method: "post",
    headers: { "Content-Type": "application/json" },
    payload: JSON.stringify({ text: text }),
    muteHttpExceptions: true,
  };

  const response = UrlFetchApp.fetch("https://megumiru.pythonanywhere.com/translate", options);

  const responseCode = response.getResponseCode();
  const responseText = response.getContentText();

  Logger.log("HTTP Status: " + responseCode);
  Logger.log("Response Text: " + responseText);

  if (responseCode === 200) {
    const result = JSON.parse(responseText);
    const translated = result.translation;

    // ç¿»è¨³çµæœã‚’éš£ã®ã‚»ãƒ«ã«å‡ºåŠ›
    sheet.getRange(cell.getRow(), cell.getColumn() + 1).setValue(translated);
  } else {
    // ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’ã‚·ãƒ¼ãƒˆã®éš£ã®ã‚»ãƒ«ã«è¡¨ç¤º
    sheet.getRange(cell.getRow(), cell.getColumn() + 1).setValue("ç¿»è¨³å¤±æ•—: " + responseCode);
  }
}


